<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>combio.core.stimulus &mdash; Combio package  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Combio package
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package/index.html">Package contents</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Combio package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>combio.core.stimulus</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for combio.core.stimulus</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sounddevice</span> <span class="k">as</span> <span class="nn">sd</span>
<span class="kn">from</span> <span class="nn">mingus.containers</span> <span class="kn">import</span> <span class="n">Note</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">from</span> <span class="nn">combio.core</span> <span class="kn">import</span> <span class="n">helpers</span>


<div class="viewcode-block" id="Stimulus"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus">[docs]</a><span class="k">class</span> <span class="nc">Stimulus</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Stimulus object holds a sound. You can use the different class methods to generate a sound,</span>
<span class="sd">    to get a sound from a .wav file, or to import a Parselmouth Sound object.</span>
<span class="sd">    This Stimulus sound is used when generating a trial with the `StimSequence` class.</span>
<span class="sd">    Additionally, one can plot a Stimulus object, change the amplitude, etc.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling frequency of the sound. 48000 is used as the standard in this package.</span>
<span class="sd">    samples : np.float64</span>
<span class="sd">        Contains the samples of the sound.</span>
<span class="sd">    dtype : numpy.dtype</span>
<span class="sd">        Contains the NumPy data type object. Hard-coded as np.float64. If a read .wav file has a different dtype,</span>
<span class="sd">        the samples will be converted to np.float64.</span>
<span class="sd">    n_channels : int</span>
<span class="sd">        The Stimulus&#39; number of channels. 1 for mono, 2 for stereo.</span>
<span class="sd">    name : str</span>
<span class="sd">        Defaults to None. If name is provided during object construction it is saved here.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Stimulus.__init__"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">samples</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">fs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of Stimulus object. &quot;&quot;&quot;</span>

        <span class="c1"># Check number of channels from array&#39;s dimensions:</span>
        <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong number of dimensions in given samples. Can only be 1 (mono) or 2 (stereo).&quot;</span><span class="p">)</span>

        <span class="c1"># Save attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">n_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Object of type Stimulus</span><span class="se">\n</span><span class="s2">Stimulus name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Stimulus duration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_ms</span><span class="si">}</span><span class="s2"> &quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;milliseconds&quot;</span>

<div class="viewcode-block" id="Stimulus.from_wav"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.from_wav">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_wav</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                 <span class="n">new_fs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Stimulus</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method loads a stimulus from a PCM .wav file, and reads in the samples.</span>
<span class="sd">        It additionally converts .wav files with dtype int16 or int32 to float64.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath: str or PathLike object</span>
<span class="sd">            The location of the .wav file. Either pass it e.g. a Path object, or a string.</span>
<span class="sd">            Of course be aware of OS-specific filepath conventions.</span>
<span class="sd">        name: str, optional</span>
<span class="sd">            If desired, one can give a Stimulus object a name. This is used, for instance,</span>
<span class="sd">            when plotting or printing. It can always be retrieved from the Stimulus.name atrribute.</span>
<span class="sd">        new_fs : int, optional</span>
<span class="sd">            If resampling is required, you can provide the target sampling frequency here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Read in the sampling frequency and all the samples from the wav file</span>
        <span class="n">samples</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">_read_wavfile</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="n">new_fs</span><span class="o">=</span><span class="n">new_fs</span><span class="p">)</span>

        <span class="c1"># Return Stimulus object</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stimulus.generate"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.generate">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">440</span><span class="p">,</span>
                 <span class="n">fs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                 <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">osc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sine&#39;</span><span class="p">,</span>
                 <span class="n">onramp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">offramp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">ramp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Stimulus</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class method returns a Stimulus object with a generated sound, based on the given parameters.</span>
<span class="sd">        It is recommended to use the on- and offramp parameters for the best results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        freq : int, optional</span>
<span class="sd">            The pitch frequency in hertz.</span>
<span class="sd">        fs : int, optional</span>
<span class="sd">            The sampling frequency in hertz.</span>
<span class="sd">        duration : int, optional</span>
<span class="sd">            The duration in milliseconds.</span>
<span class="sd">        amplitude : float, optional</span>
<span class="sd">            Factor with which sound is amplified. Values between 0 and 1 result in sounds that are less loud,</span>
<span class="sd">            values higher than 1 in louder sounds.</span>
<span class="sd">        osc : str, optional</span>
<span class="sd">            Either &#39;sine&#39; (the default) or &#39;square&#39;.</span>
<span class="sd">        onramp : int, optional</span>
<span class="sd">            The sound&#39;s &#39;attack&#39; in milliseconds.</span>
<span class="sd">        offramp : int, optional</span>
<span class="sd">            The sound&#39;s &#39;decay&#39; in milliseconds.</span>
<span class="sd">        ramp : str, optional</span>
<span class="sd">            The type of on- and offramp used. Either &#39;linear&#39; (the default) or &#39;raised-cosine&#39;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Optionally, one can provide a name for the Stimulus. This is for instance useful when distinguishing</span>
<span class="sd">            A and B stimuli. It is used when the Stimulus sound is printed, written to a file, or when it is plotted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Stimulus</span>
<span class="sd">            A newly created Stimulus object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate(freq=1000, duration=100, onramp=10, offramp=10)</span>
<span class="sd">        &gt;&gt;&gt; stim.plot_waveform()  # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Duration in seconds</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># Generate signal</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">osc</span> <span class="o">==</span> <span class="s1">&#39;sine&#39;</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">samples</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">osc</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">samples</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Choose existing oscillator (for now only &#39;sine&#39; or &#39;square&#39;)&quot;</span><span class="p">)</span>

        <span class="c1"># Make ramps</span>
        <span class="n">signal</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">_make_ramps</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">onramp</span><span class="p">,</span> <span class="n">offramp</span><span class="p">,</span> <span class="n">ramp</span><span class="p">)</span>

        <span class="c1"># Return class</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stimulus.from_note"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.from_note">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_note</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                  <span class="n">note_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                  <span class="n">fs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">,</span>
                  <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="n">osc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sine&#39;</span><span class="p">,</span>
                  <span class="n">onramp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">offramp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">ramp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Stimulus</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a Stimulus object on the basis of a note as a string.</span>
<span class="sd">        For instance, a note_str of &#39;G4&#39; results in a generated Stimulus with a pitch frequency of 392 hertz.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        note_str: str</span>
<span class="sd">            A note as a string. Can either be &#39;G&#39; or &#39;G4&#39;.</span>
<span class="sd">        duration : int, optional</span>
<span class="sd">            The duration in milliseconds.</span>
<span class="sd">        fs : int, optional</span>
<span class="sd">            The sampling frequency in hertz.</span>
<span class="sd">        amplitude : float, optional</span>
<span class="sd">            Factor with which sound is amplified. Values between 0 and 1 result in sounds that are less loud,</span>
<span class="sd">            values higher than 1 in louder sounds.</span>
<span class="sd">        osc : str, optional</span>
<span class="sd">            Either &#39;sine&#39; (the default) or &#39;square&#39;.</span>
<span class="sd">        onramp : int, optional</span>
<span class="sd">            The sound&#39;s &#39;attack&#39; in milliseconds.</span>
<span class="sd">        offramp : int, optional</span>
<span class="sd">            The sound&#39;s &#39;decay&#39; in milliseconds.</span>
<span class="sd">        ramp : str, optional</span>
<span class="sd">            The type of on- and offramp used. Either &#39;linear&#39; (the default) or &#39;raised-cosine&#39;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Optionally, one can provide a name for the Stimulus. This is for instance useful when distinguishing</span>
<span class="sd">            A and B stimuli. It is used when the Stimulus sound is printed, written to a file, or when it is plotted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Stimulus</span>
<span class="sd">            A newly created Stimulus object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.from_note(&#39;G&#39;, duration=20)</span>

<span class="sd">        &gt;&gt;&gt; stim = Stimulus.from_note(&#39;G4&#39;, onramp=10, offramp=10, ramp=&#39;raised-cosine&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">note_strings</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z])([0-9]?)&quot;</span><span class="p">,</span> <span class="n">note_str</span><span class="p">)</span>
        <span class="n">note_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">note_strings</span> <span class="k">if</span> <span class="n">string</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">note_strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">Note</span><span class="p">(</span><span class="n">note_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_hertz</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">note_strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">note</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">note_strings</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">Note</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">.</span><span class="n">to_hertz</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provide one note as either e.g. &#39;G&#39; or &#39;G4&#39; &quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Stimulus</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
                                 <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                 <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
                                 <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
                                 <span class="n">osc</span><span class="o">=</span><span class="n">osc</span><span class="p">,</span>
                                 <span class="n">onramp</span><span class="o">=</span><span class="n">onramp</span><span class="p">,</span>
                                 <span class="n">offramp</span><span class="o">=</span><span class="n">offramp</span><span class="p">,</span>
                                 <span class="n">ramp</span><span class="o">=</span><span class="n">ramp</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stimulus.from_parselmouth"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.from_parselmouth">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_parselmouth</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sound_object</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Stimulus</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class method generates a Stimulus object from a `parselmouth.Sound` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sound_object : parselmouth.Sound object</span>
<span class="sd">            The to-be imported Parselmouth Sound object</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Optionally, one can provide a name for the Stimulus. This is for instance useful when distinguishing</span>
<span class="sd">            A and B stimuli. It is used when the Stimulus sound is printed, written to a file, or when it is plotted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Stimulus</span>
<span class="sd">            A newly created Stimulus object.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        https://parselmouth.readthedocs.io/en/latest/api_reference.html#parselmouth.Sound</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sound_object</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Sound&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide a parselmouth.Sound object.&quot;</span><span class="p">)</span>

        <span class="n">fs</span> <span class="o">=</span> <span class="n">sound_object</span><span class="o">.</span><span class="n">sampling_frequency</span>

        <span class="k">if</span> <span class="n">sound_object</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">sound_object</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sound_object</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">sound_object</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect number of dimensions in samples. Should be 1 (mono) or 2 (stereo).&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

    <span class="c1"># Manipulation</span>
<div class="viewcode-block" id="Stimulus.change_amplitude"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.change_amplitude">[docs]</a>    <span class="k">def</span> <span class="nf">change_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This method can be used to change the amplitude of the Stimulus sound.</span>
<span class="sd">        A factor between 0 and 1 decreases the amplitude; a factor larger than 1 increases the amplitude.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide a &#39;factor&#39; larger than zero.&quot;</span><span class="p">)</span>

        <span class="c1"># get original frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">*=</span> <span class="n">factor</span></div>

    <span class="c1"># Visualization</span>
<div class="viewcode-block" id="Stimulus.play"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.play">[docs]</a>    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method uses the sounddevice library to play the Stimulus sound.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop: bool, optional</span>
<span class="sd">            If &#39;True&#39;, the Stimulus object is played until the `Stimulus.stop()` method is called.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        https://python-sounddevice.readthedocs.io</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate()</span>
<span class="sd">        &gt;&gt;&gt; stim.play()  # doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sd</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span></div>

<div class="viewcode-block" id="Stimulus.stop"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop playing the Stimulus sound. Calls the .stop() function from the sounddevice library.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        https://python-sounddevice.readthedocs.io</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import time  # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate()  # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; stim.play()  # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(secs=1)  # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; stim.stop()  # doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Stimulus.plot_waveform"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.plot_waveform">[docs]</a>    <span class="k">def</span> <span class="nf">plot_waveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;seaborn&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">suppress_display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        style : str, optional</span>
<span class="sd">            Style used by matplotlib, defaults to &#39;seaborn&#39;. See matplotlib docs for other styles.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            If desired, one can provide a title for the plot.</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            A tuple containing the desired output size of the plot in inches, e.g. (4, 1).</span>
<span class="sd">        suppress_display : bool, optional</span>
<span class="sd">            If &#39;True&#39;, plt.show() is not run. Defaults to &#39;False&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : Figure</span>
<span class="sd">            A matplotlib Figure object</span>
<span class="sd">        ax : Axes</span>
<span class="sd">            A matplotlib Axes object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate()</span>
<span class="sd">        &gt;&gt;&gt; stim.plot_waveform(title=&quot;Waveform of stimulus&quot;)  # doctest: +SKIP</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt  # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate()</span>
<span class="sd">        &gt;&gt;&gt; fig, ax = stim.plot_waveform(suppress_display=True)</span>
<span class="sd">        &gt;&gt;&gt; fig.set_facecolor(&#39;blue&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()  # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">plot_waveform</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span>
                                        <span class="n">fs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span>
                                        <span class="n">n_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span><span class="p">,</span>
                                        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
                                        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
                                        <span class="n">suppress_display</span><span class="o">=</span><span class="n">suppress_display</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

    <span class="c1"># Stats</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration_s</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The duration of the Stimulus sound in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration_ms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The duration of the Stimulus sound in milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="c1"># Out</span>
<div class="viewcode-block" id="Stimulus.write_wav"><a class="viewcode-back" href="../../../package/core.html#combio.core.stimulus.Stimulus.write_wav">[docs]</a>    <span class="k">def</span> <span class="nf">write_wav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Stimulus sound to disk as a wave file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        out_path: str or PathLike object</span>
<span class="sd">            The output destination for the .wav file. Either pass e.g. a Path object, or a pass a string. Of course be aware of OS-specific filepath conventions.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; stim = Stimulus.generate()</span>
<span class="sd">        &gt;&gt;&gt; stim.write_wav(&#39;my_stimulus.wav&#39;)  # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span></div></div>


<span class="k">def</span> <span class="nf">_make_ramps</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">onramp</span><span class="p">,</span> <span class="n">offramp</span><span class="p">,</span> <span class="n">ramp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal function used to create on- and offramps. Supports &#39;linear&#39; and &#39;raised-cosine&#39; ramps.&quot;&quot;&quot;</span>
    <span class="c1"># Create onramp</span>
    <span class="k">if</span> <span class="n">onramp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">onramp_samples_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">onramp</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">end_point</span> <span class="o">=</span> <span class="n">onramp_samples_len</span>

        <span class="k">if</span> <span class="n">ramp</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">onramp_amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">onramp_samples_len</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ramp</span> <span class="o">==</span> <span class="s1">&#39;raised-cosine&#39;</span><span class="p">:</span>
            <span class="n">hanning_complete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">onramp_samples_len</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">onramp_amps</span> <span class="o">=</span> <span class="n">hanning_complete</span><span class="p">[:(</span><span class="n">hanning_complete</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>  <span class="c1"># only first half of Hanning window</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown ramp type. Use &#39;linear&#39; or &#39;raised-cosine&#39;&quot;</span><span class="p">)</span>

        <span class="n">signal</span><span class="p">[:</span><span class="n">end_point</span><span class="p">]</span> <span class="o">*=</span> <span class="n">onramp_amps</span>

    <span class="k">elif</span> <span class="n">onramp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Onramp cannot be negative&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">onramp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong value supplied to onramp argument.&quot;</span><span class="p">)</span>

    <span class="c1"># Create offramp</span>
    <span class="k">if</span> <span class="n">offramp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">offramp_samples_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">offramp</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">start_point</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">offramp_samples_len</span>

        <span class="k">if</span> <span class="n">ramp</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">offramp_amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">offramp</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ramp</span> <span class="o">==</span> <span class="s1">&#39;raised-cosine&#39;</span><span class="p">:</span>
            <span class="n">hanning_complete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">offramp_samples_len</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">offramp_amps</span> <span class="o">=</span> <span class="n">hanning_complete</span><span class="p">[</span><span class="n">hanning_complete</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown ramp type. Use &#39;linear&#39; or &#39;raised-cosine&#39;&quot;</span><span class="p">)</span>

        <span class="n">signal</span><span class="p">[</span><span class="n">start_point</span><span class="p">:]</span> <span class="o">*=</span> <span class="n">offramp_amps</span>

    <span class="k">elif</span> <span class="n">offramp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Offramp cannot be negative&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">offramp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong value supplied to offramp argument.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span><span class="p">,</span> <span class="n">fs</span>


<span class="k">def</span> <span class="nf">_read_wavfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
                  <span class="n">new_fs</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal function used to read a wave file. Returns the wave file&#39;s samples and the sampling frequency.</span>
<span class="sd">    If dtype is different than np.float64, it converts the samples to that.&quot;&quot;&quot;</span>
    <span class="n">file_fs</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Change dtype so we always have float64</span>
    <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;int16&#39;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">32768.0</span>
    <span class="k">elif</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;int32&#39;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2147483648.0</span>
    <span class="k">elif</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float32&#39;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float64&#39;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown dtype for wav file. &#39;int16&#39;, &#39;int32&#39;, &#39;float32&#39; and &#39;float64&#39; are supported:&#39;&quot;</span>
                         <span class="s2">&quot;https://docs.scipy.org/doc/scipy/reference/generated/scipy.io.wavfile.read.html&quot;</span><span class="p">)</span>

    <span class="c1"># Resample if necessary</span>
    <span class="k">if</span> <span class="n">new_fs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">file_fs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">samples</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">file_fs</span><span class="p">,</span> <span class="n">new_fs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">fs</span>


<span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">input_fs</span><span class="p">,</span> <span class="n">output_fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal function used to resample sounds. Uses scipy.signal.resample&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_fs</span> <span class="o">==</span> <span class="n">input_fs</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">input_fs</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
    <span class="k">elif</span> <span class="n">output_fs</span> <span class="o">!=</span> <span class="n">input_fs</span><span class="p">:</span>
        <span class="n">resample_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">output_fs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_fs</span><span class="p">)</span>
        <span class="n">resampled</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">resample_factor</span><span class="p">))</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">resampled</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">output_fs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error while comparing old and new sampling frequencies.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">fs</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Jelle van der Werff &amp; Yannick Jadoul.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>